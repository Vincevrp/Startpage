window.onload=function(){const a={bodyClassAdd:b=>a.el("body").classList.add(b),bodyClassHas:b=>a.el("body").classList.contains(b),bodyClassRemove:b=>a.el("body").classList.remove(b),el:a=>document.querySelector(a),els:a=>[].slice.call(document.querySelectorAll(a)||[]),escapeRegex:a=>a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),ieq:(c,a)=>c.toLowerCase()===a.toLowerCase(),iin:(c,a)=>-1!==c.toLowerCase().indexOf(a.toLowerCase()),isDown:b=>["c-n","down","tab"].includes(a.key(b)),isRemove:b=>["backspace","delete"].includes(a.key(b)),isUp:b=>["c-p","up","s-tab"].includes(a.key(b)),jsonp:b=>{let c=document.createElement("script");c.src=b,a.el("head").appendChild(c)},key:a=>{const b=a.ctrlKey,c=a.shiftKey;switch(a.which){case 8:return"backspace";case 9:return c?"s-tab":"tab";case 13:return"enter";case 16:return"shift";case 17:return"ctrl";case 18:return"alt";case 27:return"escape";case 38:return"up";case 40:return"down";case 46:return"delete";case 78:return b?"c-n":"n";case 80:return b?"c-p":"n";case 91:return"super";}}};class b{constructor(b){this._el=a.el("#clock"),this._delimiter=b.delimiter,this._form=b.form,this._setTime=this._setTime.bind(this),this._registerEvents(),this._start()}_pad(a){return("0"+a.toString()).slice(-2)}_registerEvents(){this._el.addEventListener("click",this._form.show)}_setTime(){const a=new Date,b=this._pad(a.getHours()),c=this._pad(a.getMinutes());this._el.innerHTML=b+this._delimiter+c}_start(){this._setTime(),setInterval(this._setTime,1e3)}}class c{constructor(b){this._el=a.el("#help"),this._commands=b.commands,this._newTab=b.newTab,this._toggled=!1,this._buildAndAppendLists(),this._bindMethods(),this._registerEvents()}toggle(b){this._toggled="undefined"==typeof b?!this._toggled:b,this._toggled?a.bodyClassAdd("help"):a.bodyClassRemove("help")}_bindMethods(){this._handleKeydown=this._handleKeydown.bind(this)}_buildAndAppendLists(){const a=document.createElement("ul");a.classList.add("categories"),this._getCategories().forEach(b=>{a.insertAdjacentHTML("beforeend",`<li class="category">
          <h2 class="category-name">${b}</h2>
          <ul>${this._buildListCommands(b)}</ul>
        </li>`)}),this._el.appendChild(a)}_buildListCommands(a){return this._commands.map(([b,c,d,e])=>{if(b===a)return`<li class="command">
            <a href="${e}" target="${this._newTab?"_blank":"_self"} rel="noopener" ">
              <span class="command-key">${d}</span>
              <span class="command-name">${c}</span>
            </a>
          </li>`}).join("")}_getCategories(){const a=this._commands.map(([a])=>a).filter(a=>a);return[...new Set(a)]}_handleKeydown(b){"escape"===a.key(b)&&this.toggle(!1)}_registerEvents(){document.addEventListener("keydown",this._handleKeydown)}}class d{constructor(a){this._limit=a.limit,this._queryParser=a.queryParser}addItem(){}getSuggestions(){}_addSearchPrefix(a,b){const c=this._getSearchPrefix(b);return a.map(a=>c?c+a:a)}_getSearchPrefix(a){const{isSearch:b,key:c,split:d}=this._parseQuery(a);return!!b&&`${c}${d} `}_parseQuery(a){return this._queryParser.parse(a)}}class e extends d{constructor({defaultSuggestions:a}){super(...arguments),this._defaultSuggestions=a}getSuggestions(a){return new Promise(b=>{const c=this._defaultSuggestions[a];b(c?c.slice(0,this._limit):[])})}}class f extends d{constructor({queryParser:a}){super(...arguments)}getSuggestions(b){const{query:c}=this._parseQuery(b);return c?new Promise(d=>{const e="autocompleteCallback";window[e]=e=>{const f=e.map(a=>a.phrase).filter(b=>!a.ieq(b,c)).slice(0,this._limit);d(this._addSearchPrefix(f,b))},a.jsonp(`${"https://duckduckgo.com/ac/"}?callback=${e}&q=${c}`)}):Promise.resolve([])}}class g extends d{constructor(){super(...arguments),this._storeName="history"}addItem(b){if(2>b.length)return;let c;const d=this._getHistory().map(([d,e])=>{const f=a.ieq(d,b);return f&&(c=!0),[d,f?e+1:e]});c||d.push([b,1]),this._setHistory(this._sort(d))}getSuggestions(a){return new Promise(b=>{const c=this._getHistory().map(([a])=>a).filter(b=>this._itemContainsQuery(a,b)).slice(0,this._limit);b(c)})}_fetch(){return JSON.parse(localStorage.getItem(this._storeName))||[]}_getHistory(){return this._history=this._history||this._fetch(),this._history}_itemContainsQuery(b,c){return b&&!a.ieq(c,b)&&a.iin(c,b)}_save(a){localStorage.setItem(this._storeName,JSON.stringify(a))}_setHistory(a){this._history=a,this._save(a)}_sort(a){return a.sort((a,b)=>a[1]-b[1]).reverse()}}class h{constructor(b){this._el=a.el("#search-suggestions"),this._influencers=b.influencers,this._limit=b.limit,this._suggestionEls=[],this._bindMethods(),this._registerEvents()}setOnClick(a){this._onClick=a}setOnHighlight(a){this._onHighlight=a}setOnUnhighlight(a){this._onUnhighlight=a}success(a){this._clearSuggestions(),this._influencers.forEach(b=>b.addItem(a))}suggest(b){b=b.trim(),""===b&&this._clearSuggestions(),Promise.all(this._getInfluencerPromises(b)).then(c=>{const d=this._flattenAndUnique(c);this._clearSuggestions(),d.length&&(this._appendSuggestions(d,b),this._registerSuggestionEvents(),a.bodyClassAdd("suggestions"))})}_appendSuggestions(b,c){b.some((b,d)=>{const e=new RegExp(a.escapeRegex(c),"ig"),f=b.replace(e,`<b>${c}</b>`);return this._el.insertAdjacentHTML("beforeend",`<li>
          <button
            type="button"
            class="js-search-suggestion search-suggestion"
            data-suggestion="${b}"
            tabindex="-1"
          >
            ${f}
          </button>
        </li>`),d+1>=this._limit}),this._suggestionEls=a.els(".js-search-suggestion")}_bindMethods(){this._handleKeydown=this._handleKeydown.bind(this)}_clearClickEvents(){this._suggestionEls.forEach(a=>{const b=this._onClick.bind(null,a.value);a.removeEventListener("click",b)})}_clearSuggestions(){a.bodyClassRemove("suggestions"),this._clearClickEvents(),this._suggestionEls=[],this._el.innerHTML=""}_flattenAndUnique(a){return[...new Set([].concat.apply([],a))]}_focusNext(a){const b=this._suggestionEls.some((b,c)=>{if(b.classList.contains("highlight"))return this._highlight(this._suggestionEls[c+1],a),!0});b||this._highlight(this._suggestionEls[0],a)}_focusPrevious(a){const b=this._suggestionEls.some((b,c)=>{if(b.classList.contains("highlight")&&c)return this._highlight(this._suggestionEls[c-1],a),!0});b||this._unHighlight(a)}_getInfluencerPromises(a){return this._influencers.map(b=>b.getSuggestions(a))}_handleKeydown(b){a.isDown(b)&&this._focusNext(b),a.isUp(b)&&this._focusPrevious(b)}_highlight(a,b){this._unHighlight(),a&&(this._onHighlight(a.getAttribute("data-suggestion")),a.classList.add("highlight"),b.preventDefault())}_registerEvents(){document.addEventListener("keydown",this._handleKeydown)}_registerSuggestionEvents(){this._suggestionEls.forEach(a=>{const b=a.getAttribute("data-suggestion");a.addEventListener("mouseover",this._highlight.bind(this,a)),a.addEventListener("mouseout",this._unHighlight.bind(this)),a.addEventListener("click",this._onClick.bind(null,b))})}_unHighlight(b){const c=a.el(".highlight");c&&(this._onUnhighlight(),c.classList.remove("highlight"),b&&b.preventDefault())}}class i{constructor(a){this._commands=a.commands,this._searchDelimiter=a.searchDelimiter,this._pathDelimiter=a.pathDelimiter,this._protocolRegex=/^[a-zA-Z]+:\/\//i,this._urlRegex=/^((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)$/i}parse(a){const b={query:a,split:null};if(a.match(this._urlRegex)){const c=a.match(this._protocolRegex);b.redirect=c?a:"http://"+a}else{const c=a.split(this._searchDelimiter),d=a.split(this._pathDelimiter);this._commands.some(([e,f,g,h,i])=>(b.isKey=a===g,b.isSearch=!b.isKey&&c[0]===g,b.isPath=!b.isKey&&d[0]===g,b.isKey||b.isSearch||b.isPath?(b.key=g,b.isSearch&&i?(b.split=this._searchDelimiter,b.query=this._shiftAndTrim(c,b.split),b.redirect=this._prepSearch(h,i,b.query)):b.isPath?(b.split=this._pathDelimiter,b.path=this._shiftAndTrim(d,b.split),b.redirect=this._prepPath(h,b.path)):b.redirect=h,!0):void("*"===g&&(b.redirect=this._prepSearch(h,i,a)))))}return b.color=this._getColorFromUrl(b.redirect),b}_getColorFromUrl(a){const b=this._getHostname(a),c=this._commands.filter(a=>this._getHostname(a[3])===b).map(a=>a[5])[0];return c||null}_getHostname(a){const b=document.createElement("a");return b.href=a,b.hostname.replace(/^www./,"")}_prepPath(a,b){return this._stripUrlPath(a)+"/"+b}_prepSearch(a,b,c){if(!b)return a;const d=this._stripUrlPath(a),e=encodeURIComponent(c);return b=b.replace("{}",e),d+b}_shiftAndTrim(a,b){return a.shift(),a.join(b).trim()}_stripUrlPath(a){const b=document.createElement("a");return b.href=a,`${b.protocol}//${b.hostname}`}}class j{constructor(b){this._formEl=a.el("#search-form"),this._inputEl=a.el("#search-input"),this._colors=b.colors,this._help=b.help,this._suggester=b.suggester,this._queryParser=b.queryParser,this._instantRedirect=b.instantRedirect,this._newTab=b.newTab,this._inputElVal="",this._bindMethods(),this._registerEvents(),this._loadQueryParam()}hide(){a.bodyClassRemove("form"),this._inputEl.value="",this._inputElVal=""}show(){a.bodyClassAdd("form"),this._inputEl.focus()}_bindMethods(){this.hide=this.hide.bind(this),this.show=this.show.bind(this),this._clearPreview=this._clearPreview.bind(this),this._handleKeydown=this._handleKeydown.bind(this),this._handleInput=this._handleInput.bind(this),this._previewValue=this._previewValue.bind(this),this._submitForm=this._submitForm.bind(this),this._submitWithValue=this._submitWithValue.bind(this)}_clearPreview(){this._previewValue(this._inputElVal),this._inputEl.focus()}_handleKeydown(b){if(!(a.isUp(b)||a.isDown(b)||a.isRemove(b))){switch(a.key(b)){case"alt":case"ctrl":case"enter":""===this._inputEl.value&&this._help.toggle();;return;case"shift":case"super":return;case"escape":return void this.hide();}this.show()}}_handleInput(){const a=this._inputEl.value,b="?"===a,{isKey:c}=this._queryParser.parse(a);this._inputElVal=a,this._setBackgroundFromQuery(a),(!a||b)&&this.hide(),b&&this._help.toggle(),this._instantRedirect&&c&&this._submitWithValue(a),this._suggester&&this._suggester.suggest(a)}_loadQueryParam(){const a=new URLSearchParams(window.location.search).get("q");a&&this._submitWithValue(a)}_previewValue(a){this._inputEl.value=a,this._setBackgroundFromQuery(a)}_redirect(a){this._newTab?window.open(a,"_blank"):window.location.href=a}_registerEvents(){document.addEventListener("keydown",this._handleKeydown),this._inputEl.addEventListener("input",this._handleInput),this._formEl.addEventListener("submit",this._submitForm,!1),this._suggester&&(this._suggester.setOnClick(this._submitWithValue),this._suggester.setOnHighlight(this._previewValue),this._suggester.setOnUnhighlight(this._clearPreview))}_setBackgroundFromQuery(a){if(this._colors){const{color:b}=this._queryParser.parse(a);this._formEl.style.backgroundColor=b}}_submitForm(a){a&&a.preventDefault();const b=this._inputEl.value;this._suggester&&this._suggester.success(b),this.hide(),this._redirect(this._queryParser.parse(b).redirect)}_submitWithValue(a){this._inputEl.value=a,this._submitForm()}}(function(){const a=()=>new c({commands:CONFIG.commands,newTab:CONFIG.newTab}),d=()=>{const a={Default:e,DuckDuckGo:f,History:g};return CONFIG.influencers.map(b=>new a[b.name]({limit:b.limit,queryParser:l(),defaultSuggestions:CONFIG.defaultSuggestions}))},k=()=>new h({influencers:d(),limit:CONFIG.suggestionsLimit}),l=()=>new i({commands:CONFIG.commands,pathDelimiter:CONFIG.pathDelimiter,searchDelimiter:CONFIG.searchDelimiter});new b({delimiter:CONFIG.clockDelimiter,form:(()=>new j({colors:CONFIG.colors,help:a(),instantRedirect:CONFIG.instantRedirect,newTab:CONFIG.newTab,queryParser:l(),suggester:!!CONFIG.suggestions&&k()}))()})})()}();